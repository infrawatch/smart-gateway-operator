- name: Service monitor for smart gateway
  k8s:
    resource_definition:
      apiVersion: monitoring.coreos.com/v1
      kind: ServiceMonitor
      metadata:
        name: 'smartgateway'
        namespace: '{{ meta.namespace }}'
        labels:
          app: smart-gateway
      spec:
        selector:
          matchLabels:
            app: smart-gateway
        namespaceSelector:
          matchNames:
          - '{{ meta.namespace }}'
        endpoints:
        - port: prom-http
          interval: '{{ prometheus_scrape_interval }}'
          metricRelabelings:
          - action: labeldrop
            regex: pod
            sourcelabels: []
          - action: labeldrop
            regex: namespace
            sourcelabels: []
          - action: labeldrop
            regex: instance
            sourcelabels: []
          - action: labeldrop
            regex: job
            sourcelabels: []
